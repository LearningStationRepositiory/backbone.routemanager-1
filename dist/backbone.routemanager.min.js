(function(a){"use strict";var b=a.Backbone,c=a._,d=a.$,e=b.Router.prototype._routeToRegExp,f=b.Router.extend({constructor:function(a){var d=this,e={},f=this.routers={},g=a.routes||this.routes;return c.each(g,function(g,h){var i,j,k,l;i=a.prefix,i||(i=h||""),i[i.length-1]==="/"?i=i.slice(0,i.length-1):i&&(i+="/");if(g.prototype instanceof b.Router)j=g.prototype.constructor,l=g.extend({constructor:function(a){var d=b.Router.prototype.constructor;return c.each(this.routes,function(a,b){delete this.routes[b],b=b?i+"/"+b:i,this.routes[b]=a},this),d.apply(this,arguments)}}),k=f[h]=new l,h._state={},k.__manager__={},c.isFunction(j)&&j.call(k),k.__manager__.prefix=i;else if(c.isString(g)&&c.isString(h)){d[g]=a[g],delete a[g];if(h)return e[i+h]=g;e[i]=g}}),this.routes=e,b.Router.prototype.constructor.call(this)},navigate:function(a,d){function g(b,d){var g=e[0],h=c.chain(g[b]);f[b]=f[b]||[],h.filter(function(b,c){return d+"/"+c===a}),h=c.reduce(h.value(),function(a,b){return a.concat(b)},[]),h=c.map(h,function(a){var b,d;return c.find(e,function(e){if(c.isFunction(e[a]))return b=e,d=e[a]}),c.isFunction(d)||(d=function(){}),[b,d]}),f[b]=f[b].concat(h)}function h(a){var b=a.__manager__.prefix;e.unshift(a),g("before",b),g("after",b),a.routers&&c.each(a.routers,function(a){return h(a)})}var e=[],f={};h(this),c.each(f.before,function(a){a[1].call(a[0])}),b.history.navigate(a,d)},__manager__:{prefix:""}},{configure:function(a){var d=b.RouteManager.prototype.options;if(c.isObject(a))return c.extend(d,a)}});f.prototype.options={deferred:function(){return d.Deferred()}},b.RouteManager=f})(this)