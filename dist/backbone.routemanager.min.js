(function(a){function b(a,b){function j(a){var b,c,d=[],e=a.toString().match(/function\s+\(([^)]*)\)/)[1].split(", ");for(b=0;b<e.length;b++)c=e[b],(c=c.replace(/\/\*.*\*\//,""))&&d.push(c.replace(/^\s+|\s+$/g,""));return d}function k(a,b){var c=g[0],h=d.chain(c[a]);f[a]=f[a]||[],h.filter(function(a,c){return b+"/"+c===e}),h=d.reduce(h.value(),function(a,b){return a.concat(b)},[]),h=d.map(h,function(a){var b,c;return d.find(g,function(e){if(d.isFunction(e[a]))return b=e,c=e[a]}),d.isFunction(c)||(c=function(){}),[b,c]}),f[a]=f[a].concat(h)}function l(a){var b=a.__manager__.prefix;g.unshift(a),k("before",b),k("after",b),a.routers&&d.each(a.routers,function(a){return l(a)})}var e,f=[],g=[],h=this,i=d.map(b.match(/:(\w+)|\*(\w+)/g),function(a){return a.slice(1)});return function(){var b=arguments;e=c.history.fragment,this.params={},d.each(i,function(a,c){this.params[a]=b[c]},this),l(h),d.each(f.before,function(b){var c=[];d.each(j(a),function(a,b){c[b]=this.params[a]},this),b[1].apply(b[0],c)},this),a.apply(h,arguments),g=[],f=[]}}"use strict";var c=a.Backbone,d=a._,e=a.$,f=c.Router.extend({constructor:function(a){var e=this,f={},g=this.routers={},h=a.routes||this.routes;return d.each(h,function(h,i){var j,k,l,m,n;j=a.prefix,j||(j=i||""),j[j.length-1]==="/"?j=j.slice(0,j.length-1):j&&(j+="/");if(h.prototype instanceof c.Router)k=h.prototype.constructor,m=h.extend({constructor:function(a){var e=c.Router.prototype.constructor;return d.each(this.routes,function(a,c){delete this.routes[c],c=c?j+"/"+c:j,this.routes[c]=a,this[a]=b.call(this,this[a],c)},this),e.apply(this,arguments)}}),l=g[i]=new m,i._state={},l.__manager__={},d.isFunction(k)&&k.call(l),l.__manager__.prefix=j;else if(d.isString(h)&&d.isString(i)){j=a.prefix?a.prefix:"",e[h]=b.call(e,a[h],i),delete a[h];if(i)return f[j+i]=h;f[j]=h}}),this.routes=f,c.Router.prototype.constructor.call(this)},__manager__:{prefix:""}},{configure:function(a){var b=c.RouteManager.prototype.options;if(d.isObject(a))return d.extend(b,a)}});f.prototype.options={deferred:function(){return e.Deferred()}},c.RouteManager=f})(this)